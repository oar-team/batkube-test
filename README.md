# Batkube test

This is a repository to conduct experimentations on Batkube, as well as real
experiments on an emulated Kubernetes cluster with inputs in the form of a
Batsim workload.

## Usage and contents

### Experiments on emulated cluster

- [startup-cluster.sh](scripts/startup-cluster.sh) will set up an emulated k3s
    cluster for you with desired amount of nodes, and cpu and memory capacity
    per node. Note that cpu and memory are limited by the host machine. It
    relies on docker and docker-compose.
- [main.go](real-cluster-experiment/main.go) will launch an experiment on a
    real cluster. It takes a Batsim workload as an input and will produce a csv
    outputs just like Batsim. Usage: first launch a scheduler and give it the
    `kubeconfig.yaml` generated by startup-cluster.sh, and then launch the
    experiment. See its help section for more details.

Note: Resource cleaning will always be an issue between experiments. To start
over, re-launch everything to make sure there are no dangling resources at the
end of the experiment.

### Workload generation

Tools are provided to generate workload in Batsim's json format from worklaods
in swf format.

- [swf-analysis.py](scripts/swf-analysis.py) is a very simple script based on
    evalys to extract subsets of a workload. See `python3 swf-analysis.py
    --help` for more details.
- [swf-to-json.go](swf-translate/swf-to-json.go) translates a workload from swf
    format to Batsim's json workload format. It has capabilities such as
    normalizing or uniformizing jobs resource usage and trim of jobs duration,
    to comply with real experiments limitations.

### Experiments on Batkube

These scripts do not implement any flags, you should open them and customize
them depending on your needs and filesystem. Their outputs are csv file
containing the results of the experiment.

- [min-delay.sh](scripts/min-delay.sh) runs an experiment on the `min-delay`
    parameter of Batkube.

### Others

- [gantt.r](scripts/gantt.r) is an old script used to generate Gantt charts
    from a Batsim `out_jobs.csv` output.
- [dataviz.py](scripts/dataviz.py) is another simplistic script based on evalys
    to plot graphs from a Batsim output.
